<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio - Social Network</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <nav>
        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">MySocial</div>
        <div>
            <a href="index.html">Inicio</a>
            <a href="profile.html">Mi Perfil</a>
            <a href="#" onclick="logout()">Salir</a>
        </div>
    </nav>

    <div class="container">
        <!-- Create Post Section (New for Feed) -->
        <div class="glass-card post-card">
            <form id="publish-form">
                <div style="display:flex; align-items:center;">
                    <img src="assets/img/default_avatar.png" id="current-user-avatar" class="user-avatar"
                        style="width:32px; height:32px;">
                    <input type="text" id="post-content" placeholder="Â¿QuÃ© estÃ¡s pensando, hoy?"
                        style="border-radius:20px; border:none; background:#3a3b3c; padding:10px; width:100%; color:white;"
                        required>
                </div>
                <div
                    style="margin-top:10px; border-top:1px solid var(--border-color); padding-top:10px; display:flex; justify-content:space-between;">
                    <label
                        style="cursor:pointer; color:var(--text-secondary); display:flex; align-items:center; gap:5px;">
                        <span>ðŸ“· Foto/Video</span>
                        <input type="file" id="post-image-file" accept="image/*" style="display:none">
                    </label>
                    <button type="submit" style="width:auto; margin:0;">Publicar</button>
                </div>
                <div id="file-name" style="font-size:0.8em; color:var(--primary-color); padding-left:42px;"></div>
            </form>
        </div>

        <!-- Feed Container -->
        <div id="feed-container">
            <p style="text-align: center; color: var(--text-secondary);">Cargando publicaciones...</p>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Social Network. All rights reserved.</p>
    </footer>
    <script src="assets/js/app.js"></script>
    <script>
        document.getElementById('post-image-file').addEventListener('change', function () {
            document.getElementById('file-name').textContent = this.files[0] ? this.files[0].name : '';
        });

        // Check session
        checkSession().then(user => {
            if (!user) window.location.href = 'login.html';
            if (user.foto_perfil) document.getElementById('current-user-avatar').src = user.foto_perfil;
            loadPosts();
            setInterval(() => loadPosts(), 5000); // Polling
        });

        async function logout() {
            await apiRequest("auth/logout.php");
            window.location.href = "login.html";
        }
    </script>
</body>

</html>